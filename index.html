<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Munsell Chart</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            letter-spacing: -0.02em;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            font-weight: 400;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-group label {
            font-weight: 600;
            color: #444;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        select {
            padding: 12px 16px;
            font-size: 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .slider-container {
            position: relative;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, #e1e5e9, #667eea);
            outline: none;
            -webkit-appearance: none;
            margin: 10px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        input[type="range"]::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .slider-value {
            position: absolute;
            top: -35px;
            right: 0;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        input[type="text"] {
            padding: 12px 16px;
            font-size: 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            background: white;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .chart {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .hue-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.4s ease;
            transform-origin: center;
        }

        .hue-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.15);
        }

        .hue-title {
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .colors-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .color-box {
            aspect-ratio: 1;
            border-radius: 16px;
            border: 3px solid rgba(255, 255, 255, 0.8);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        .color-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.2));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .color-box:hover {
            transform: scale(1.1) rotate(2deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border-color: white;
            z-index: 10;
        }

        .color-box:hover::before {
            opacity: 1;
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 500;
            display: none;
            z-index: 1000;
            pointer-events: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .tooltip::before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.9) transparent transparent transparent;
        }

        .stats {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            font-weight: 600;
            color: #666;
        }

        .advanced-tools {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .tool-button {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .tool-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }

        .tool-button:active {
            transform: translateY(0);
        }

        .tool-button.secondary {
            background: linear-gradient(135deg, #64b3f4, #c2e59c);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 80%;
            max-height: 80%;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #f0f0f0;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }

        .palette-color {
            aspect-ratio: 1;
            border-radius: 8px;
            border: 2px solid white;
            cursor: pointer;
            transition: transform 0.2s ease;
            position: relative;
        }

        .palette-color:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .palette-color::after {
            content: attr(data-hex);
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            color: #666;
            white-space: nowrap;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-item {
            text-align: center;
        }

        .comparison-color {
            width: 100px;
            height: 100px;
            border-radius: 12px;
            margin: 0 auto 10px;
            border: 3px solid white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .color-info {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }

        .export-format {
            margin: 10px 0;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .export-format:hover {
            border-color: #667eea;
        }

        .export-format input[type="radio"] {
            margin-right: 10px;
        }

        .color-blind-preview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .color-blind-type {
            text-align: center;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
        }

        .color-blind-colors {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
        }

        .color-blind-colors .small-color {
            width: 30px;
            height: 30px;
            border-radius: 6px;
            border: 1px solid #ccc;
        }

        .accessibility-info {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
        }

        .contrast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .contrast-item {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .favorite-colors {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
        }

        .favorite-color {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid white;
            cursor: pointer;
            position: relative;
            transition: transform 0.2s ease;
        }

        .favorite-color:hover {
            transform: scale(1.1);
        }

        .remove-favorite {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4757;
            color: white;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .view-mode-toggle {
            display: flex;
            background: #f0f0f0;
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 20px;
        }

        .view-mode-btn {
            flex: 1;
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-mode-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .hue-card {
            animation: fadeIn 0.6s ease forwards;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            font-size: 1.1rem;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 2rem;
            }

            .controls-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .chart {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .hue-card {
                padding: 20px;
            }

            .colors-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Advanced Munsell Color System</h1>
            <p class="subtitle">Interactive Hue, Value, and Chroma Explorer</p>
        </header>
        
        <div class="controls">
            <div class="controls-grid">
                <div class="control-group">
                    <label for="filter-hue">Filter by Hue</label>
                    <select id="filter-hue">
                        <option value="all">All Hues</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="filter-value">Value Range</label>
                    <div class="slider-container">
                        <input type="range" id="filter-value" min="0" max="9" value="0">
                        <span class="slider-value" id="value-label">All</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="filter-chroma">Chroma Level</label>
                    <div class="slider-container">
                        <input type="range" id="filter-chroma" min="0" max="14" step="2" value="0">
                        <span class="slider-value" id="chroma-label">All</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <label for="search-box">Search Hue</label>
                    <input type="text" id="search-box" placeholder="e.g., 5R, 10YR, 2.5B">
                </div>
            </div>
        </div>

        <div class="advanced-tools">
            <div class="view-mode-toggle">
                <button class="view-mode-btn active" id="grid-view">Grid View</button>
                <button class="view-mode-btn" id="wheel-view">Color Wheel</button>
                <button class="view-mode-btn" id="list-view">List View</button>
            </div>
            
            <div class="tools-grid">
                <button class="tool-button" id="color-picker">üé® Color Picker</button>
                <button class="tool-button" id="palette-generator">üé≠ Generate Palette</button>
                <button class="tool-button" id="color-compare">‚öñÔ∏è Compare Colors</button>
                <button class="tool-button secondary" id="export-colors">üíæ Export Colors</button>
                <button class="tool-button secondary" id="accessibility-check">‚ôø Accessibility</button>
                <button class="tool-button secondary" id="color-harmony">üéµ Color Harmony</button>
            </div>
            
            <div id="favorite-section" style="display: none;">
                <h4 style="margin-bottom: 10px;">‚ù§Ô∏è Favorite Colors</h4>
                <div class="favorite-colors" id="favorite-colors"></div>
                <button class="tool-button" id="clear-favorites" style="margin-top: 10px; font-size: 12px; padding: 8px 12px;">Clear All</button>
            </div>
        </div>

        <div class="chart" id="chart"></div>
        <div class="stats" id="stats"></div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <!-- Advanced Feature Modals -->
    <div class="modal" id="color-picker-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('color-picker-modal')">&times;</button>
            <h3>üé® Advanced Color Picker</h3>
            <div style="margin: 20px 0;">
                <input type="color" id="color-input" style="width: 100%; height: 60px; border: none; border-radius: 8px;">
            </div>
            <div class="color-info" id="picked-color-info"></div>
            <button class="tool-button" id="add-to-favorites" style="margin-top: 15px;">Add to Favorites</button>
        </div>
    </div>

    <div class="modal" id="palette-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('palette-modal')">&times;</button>
            <h3>üé≠ Color Palette Generator</h3>
            <div class="tools-grid" style="margin: 20px 0;">
                <button class="tool-button" onclick="generatePalette('monochromatic')">Monochromatic</button>
                <button class="tool-button" onclick="generatePalette('analogous')">Analogous</button>
                <button class="tool-button" onclick="generatePalette('complementary')">Complementary</button>
                <button class="tool-button secondary" onclick="generatePalette('triadic')">Triadic</button>
                <button class="tool-button secondary" onclick="generatePalette('tetradic')">Tetradic</button>
                <button class="tool-button secondary" onclick="generatePalette('random')">Random</button>
            </div>
            <div class="color-palette" id="generated-palette"></div>
        </div>
    </div>

    <div class="modal" id="compare-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('compare-modal')">&times;</button>
            <h3>‚öñÔ∏è Color Comparison Tool</h3>
            <div class="comparison-grid">
                <div class="comparison-item">
                    <h4>Color A</h4>
                    <div class="comparison-color" id="compare-color-a" style="background: #ff6b6b;"></div>
                    <input type="color" id="compare-input-a" value="#ff6b6b">
                </div>
                <div class="comparison-item">
                    <h4>Color B</h4>
                    <div class="comparison-color" id="compare-color-b" style="background: #4ecdc4;"></div>
                    <input type="color" id="compare-input-b" value="#4ecdc4">
                </div>
            </div>
            <div class="color-info">
                <h4>Comparison Results</h4>
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">Contrast Ratio</div>
                        <div class="info-value" id="contrast-ratio">4.5:1</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Color Difference</div>
                        <div class="info-value" id="color-difference">76.2</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">WCAG Rating</div>
                        <div class="info-value" id="wcag-rating">AA</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="export-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('export-modal')">&times;</button>
            <h3>üíæ Export Color Data</h3>
            <div style="margin: 20px 0;">
                <h4>Select Format:</h4>
                <div class="export-format">
                    <input type="radio" name="export-format" value="css" id="css-format" checked>
                    <label for="css-format">CSS Variables</label>
                </div>
                <div class="export-format">
                    <input type="radio" name="export-format" value="json" id="json-format">
                    <label for="json-format">JSON</label>
                </div>
                <div class="export-format">
                    <input type="radio" name="export-format" value="ase" id="ase-format">
                    <label for="ase-format">Adobe ASE (Swatch Exchange)</label>
                </div>
                <div class="export-format">
                    <input type="radio" name="export-format" value="png" id="png-format">
                    <label for="png-format">PNG Color Palette</label>
                </div>
            </div>
            <button class="tool-button" onclick="exportColors()">Export Selected Colors</button>
            <textarea id="export-output" style="width: 100%; height: 200px; margin-top: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 8px;" readonly></textarea>
        </div>
    </div>

    <div class="modal" id="accessibility-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('accessibility-modal')">&times;</button>
            <h3>‚ôø Accessibility Analysis</h3>
            
            <div class="color-blind-preview">
                <div class="color-blind-type">
                    <h4>Normal Vision</h4>
                    <div class="color-blind-colors" id="normal-vision"></div>
                </div>
                <div class="color-blind-type">
                    <h4>Deuteranopia</h4>
                    <div class="color-blind-colors" id="deuteranopia"></div>
                </div>
                <div class="color-blind-type">
                    <h4>Protanopia</h4>
                    <div class="color-blind-colors" id="protanopia"></div>
                </div>
                <div class="color-blind-type">
                    <h4>Tritanopia</h4>
                    <div class="color-blind-colors" id="tritanopia"></div>
                </div>
            </div>

            <div class="accessibility-info">
                <h4>WCAG Compliance Check</h4>
                <div class="contrast-grid" id="wcag-results"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="harmony-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('harmony-modal')">&times;</button>
            <h3>üéµ Color Harmony Analysis</h3>
            <div style="margin: 20px 0;">
                <label for="base-color-harmony">Base Color:</label>
                <input type="color" id="base-color-harmony" value="#667eea" style="width: 100%; height: 50px; border: none; border-radius: 8px; margin: 10px 0;">
            </div>
            <div id="harmony-results"></div>
        </div>
    </div>

    <script>
        const munsellData = [
            { hue: "5R", name: "Red", colors: [
                { hex: "#FFE6E6", value: 9, chroma: 2 },
                { hex: "#FFCCCC", value: 8, chroma: 4 },
                { hex: "#FFB3B3", value: 7, chroma: 6 },
                { hex: "#FF9999", value: 6, chroma: 8 },
                { hex: "#FF8080", value: 5, chroma: 10 },
                { hex: "#FF6666", value: 4, chroma: 12 },
                { hex: "#FF4D4D", value: 3, chroma: 14 },
                { hex: "#FF3333", value: 2, chroma: 16 }
            ]},
            { hue: "10R", name: "Red-Orange", colors: [
                { hex: "#FFE6E0", value: 9, chroma: 2 },
                { hex: "#FFCCC0", value: 8, chroma: 4 },
                { hex: "#FFB3A0", value: 7, chroma: 6 },
                { hex: "#FF9980", value: 6, chroma: 8 },
                { hex: "#FF8060", value: 5, chroma: 10 },
                { hex: "#FF6640", value: 4, chroma: 12 },
                { hex: "#FF4D20", value: 3, chroma: 14 },
                { hex: "#FF3300", value: 2, chroma: 16 }
            ]},
            { hue: "5YR", name: "Orange", colors: [
                { hex: "#FFE6D9", value: 9, chroma: 2 },
                { hex: "#FFCCB3", value: 8, chroma: 4 },
                { hex: "#FFB38D", value: 7, chroma: 6 },
                { hex: "#FF9966", value: 6, chroma: 8 },
                { hex: "#FF8040", value: 5, chroma: 10 },
                { hex: "#FF661A", value: 4, chroma: 12 },
                { hex: "#E54D00", value: 3, chroma: 14 },
                { hex: "#CC4400", value: 2, chroma: 16 }
            ]},
            { hue: "10YR", name: "Yellow-Orange", colors: [
                { hex: "#FFF2E6", value: 9, chroma: 2 },
                { hex: "#FFE6CC", value: 8, chroma: 4 },
                { hex: "#FFD9B3", value: 7, chroma: 6 },
                { hex: "#FFCC99", value: 6, chroma: 8 },
                { hex: "#FFBF80", value: 5, chroma: 10 },
                { hex: "#FFB366", value: 4, chroma: 12 },
                { hex: "#FFA64D", value: 3, chroma: 14 },
                { hex: "#FF9933", value: 2, chroma: 16 }
            ]},
            { hue: "5Y", name: "Yellow", colors: [
                { hex: "#FFFFF2", value: 9, chroma: 2 },
                { hex: "#FFFFE6", value: 8, chroma: 4 },
                { hex: "#FFFFD9", value: 7, chroma: 6 },
                { hex: "#FFFFCC", value: 6, chroma: 8 },
                { hex: "#FFFFBF", value: 5, chroma: 10 },
                { hex: "#FFFFB3", value: 4, chroma: 12 },
                { hex: "#FFFF80", value: 3, chroma: 14 },
                { hex: "#FFFF4D", value: 2, chroma: 16 }
            ]},
            { hue: "10Y", name: "Green-Yellow", colors: [
                { hex: "#F2FFE6", value: 9, chroma: 2 },
                { hex: "#E6FFCC", value: 8, chroma: 4 },
                { hex: "#D9FFB3", value: 7, chroma: 6 },
                { hex: "#CCFF99", value: 6, chroma: 8 },
                { hex: "#BFFF80", value: 5, chroma: 10 },
                { hex: "#B3FF66", value: 4, chroma: 12 },
                { hex: "#A6FF4D", value: 3, chroma: 14 },
                { hex: "#99FF33", value: 2, chroma: 16 }
            ]},
            { hue: "5GY", name: "Yellow-Green", colors: [
                { hex: "#E6FFE6", value: 9, chroma: 2 },
                { hex: "#CCFFCC", value: 8, chroma: 4 },
                { hex: "#B3FFB3", value: 7, chroma: 6 },
                { hex: "#99FF99", value: 6, chroma: 8 },
                { hex: "#80FF80", value: 5, chroma: 10 },
                { hex: "#66FF66", value: 4, chroma: 12 },
                { hex: "#4DFF4D", value: 3, chroma: 14 },
                { hex: "#33FF33", value: 2, chroma: 16 }
            ]},
            { hue: "10GY", name: "Green", colors: [
                { hex: "#E6FFEC", value: 9, chroma: 2 },
                { hex: "#CCFFD9", value: 8, chroma: 4 },
                { hex: "#B3FFC6", value: 7, chroma: 6 },
                { hex: "#99FFB3", value: 6, chroma: 8 },
                { hex: "#80FFA0", value: 5, chroma: 10 },
                { hex: "#66FF8D", value: 4, chroma: 12 },
                { hex: "#4DFF7A", value: 3, chroma: 14 },
                { hex: "#33FF66", value: 2, chroma: 16 }
            ]},
            { hue: "5G", name: "Blue-Green", colors: [
                { hex: "#E6FFF2", value: 9, chroma: 2 },
                { hex: "#CCFFE6", value: 8, chroma: 4 },
                { hex: "#B3FFD9", value: 7, chroma: 6 },
                { hex: "#99FFCC", value: 6, chroma: 8 },
                { hex: "#80FFBF", value: 5, chroma: 10 },
                { hex: "#66FFB3", value: 4, chroma: 12 },
                { hex: "#4DFFA6", value: 3, chroma: 14 },
                { hex: "#33FF99", value: 2, chroma: 16 }
            ]},
            { hue: "5B", name: "Blue", colors: [
                { hex: "#E6E6FF", value: 9, chroma: 2 },
                { hex: "#CCCCFF", value: 8, chroma: 4 },
                { hex: "#B3B3FF", value: 7, chroma: 6 },
                { hex: "#9999FF", value: 6, chroma: 8 },
                { hex: "#8080FF", value: 5, chroma: 10 },
                { hex: "#6666FF", value: 4, chroma: 12 },
                { hex: "#4D4DFF", value: 3, chroma: 14 },
                { hex: "#3333FF", value: 2, chroma: 16 }
            ]},
            { hue: "10B", name: "Purple-Blue", colors: [
                { hex: "#EDE6FF", value: 9, chroma: 2 },
                { hex: "#DBCCFF", value: 8, chroma: 4 },
                { hex: "#C9B3FF", value: 7, chroma: 6 },
                { hex: "#B799FF", value: 6, chroma: 8 },
                { hex: "#A580FF", value: 5, chroma: 10 },
                { hex: "#9366FF", value: 4, chroma: 12 },
                { hex: "#814DFF", value: 3, chroma: 14 },
                { hex: "#6F33FF", value: 2, chroma: 16 }
            ]},
            { hue: "5P", name: "Purple", colors: [
                { hex: "#F2E6FF", value: 9, chroma: 2 },
                { hex: "#E6CCFF", value: 8, chroma: 4 },
                { hex: "#D9B3FF", value: 7, chroma: 6 },
                { hex: "#CC99FF", value: 6, chroma: 8 },
                { hex: "#BF80FF", value: 5, chroma: 10 },
                { hex: "#B366FF", value: 4, chroma: 12 },
                { hex: "#A64DFF", value: 3, chroma: 14 },
                { hex: "#9933FF", value: 2, chroma: 16 }
            ]},
            { hue: "10P", name: "Red-Purple", colors: [
                { hex: "#FFE6F2", value: 9, chroma: 2 },
                { hex: "#FFCCE6", value: 8, chroma: 4 },
                { hex: "#FFB3D9", value: 7, chroma: 6 },
                { hex: "#FF99CC", value: 6, chroma: 8 },
                { hex: "#FF80BF", value: 5, chroma: 10 },
                { hex: "#FF66B3", value: 4, chroma: 12 },
                { hex: "#FF4DA6", value: 3, chroma: 14 },
                { hex: "#FF3399", value: 2, chroma: 16 }
            ]}
        ];

        const chart = document.getElementById("chart");
        const filterHue = document.getElementById("filter-hue");
        const filterValue = document.getElementById("filter-value");
        const filterChroma = document.getElementById("filter-chroma");
        const searchBox = document.getElementById("search-box");
        const tooltip = document.getElementById("tooltip");
        const valueLabel = document.getElementById("value-label");
        const chromaLabel = document.getElementById("chroma-label");
        const stats = document.getElementById("stats");

        // Populate hue filter
        munsellData.forEach(hueData => {
            const option = document.createElement("option");
            option.value = hueData.hue;
            option.textContent = `${hueData.hue} - ${hueData.name}`;
            filterHue.appendChild(option);
        });

        function updateLabels() {
            valueLabel.textContent = filterValue.value === "0" ? "All" : filterValue.value;
            chromaLabel.textContent = filterChroma.value === "0" ? "All" : filterChroma.value;
        }

        function renderChart(filters = {}) {
            const { hue, value, chroma, search } = filters;
            chart.innerHTML = "";
            let colorCount = 0;

            const filteredData = munsellData
                .filter(hueData => (!hue || hue === "all" || hueData.hue === hue) &&
                                   (!search || hueData.hue.toLowerCase().includes(search.toLowerCase()) || 
                                              hueData.name.toLowerCase().includes(search.toLowerCase())));

            if (currentViewMode === 'wheel') {
                // Color wheel view
                chart.innerHTML = `
                    <div style="display: flex; justify-content: center; align-items: center; min-height: 400px;">
                        <div style="position: relative; width: 350px; height: 350px; border-radius: 50%; background: conic-gradient(
                            ${munsellData.map((hue, index) => 
                                `${hue.colors[2].hex} ${index * (360/munsellData.length)}deg ${(index + 1) * (360/munsellData.length)}deg`
                            ).join(', ')}
                        ); box-shadow: 0 20px 40px rgba(0,0,0,0.2);">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
                                        background: white; border-radius: 50%; width: 100px; height: 100px; 
                                        display: flex; align-items: center; justify-content: center; 
                                        font-weight: bold; box-shadow: 0 10px 20px rgba(0,0,0,0.1);">
                                Munsell<br>Wheel
                            </div>
                        </div>
                    </div>
                `;
                return;
            }

            if (currentViewMode === 'list') {
                // List view
                chart.innerHTML = '';
                filteredData.forEach(hueData => {
                    const listItem = document.createElement('div');
                    listItem.style.cssText = `
                        background: rgba(255,255,255,0.95); 
                        border-radius: 15px; 
                        padding: 20px; 
                        margin-bottom: 15px;
                        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
                    `;
                    
                    const filteredColors = hueData.colors.filter(color => {
                        const valueMatch = !value || value === 0 || color.value === parseInt(value);
                        const chromaMatch = !chroma || chroma === 0 || color.chroma === parseInt(chroma);
                        return valueMatch && chromaMatch;
                    });

                    if (filteredColors.length > 0) {
                        listItem.innerHTML = `
                            <h3 style="margin-bottom: 15px; color: #333;">${hueData.hue} - ${hueData.name}</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                ${filteredColors.map(color => `
                                    <div style="display: flex; align-items: center; gap: 10px; padding: 8px; 
                                                background: #f8f9fa; border-radius: 8px; min-width: 200px;">
                                        <div style="width: 30px; height: 30px; background: ${color.hex}; 
                                                    border-radius: 6px; border: 2px solid white; 
                                                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);"></div>
                                        <div>
                                            <div style="font-weight: 600; font-size: 14px;">${color.hex}</div>
                                            <div style="font-size: 12px; color: #666;">V${color.value} C${color.chroma}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        chart.appendChild(listItem);
                        colorCount += filteredColors.length;
                    }
                });
                
                stats.textContent = `Showing ${colorCount} colors from ${filteredData.length} hues`;
                return;
            }

            filteredData.forEach(hueData => {
                const hueCard = document.createElement("div");
                hueCard.className = "hue-card";

                const hueTitle = document.createElement("h3");
                hueTitle.className = "hue-title";
                hueTitle.textContent = `${hueData.hue} - ${hueData.name}`;
                hueCard.appendChild(hueTitle);

                const colorsGrid = document.createElement("div");
                colorsGrid.className = "colors-grid";

                const filteredColors = hueData.colors.filter(color => {
                    const valueMatch = !value || value === 0 || color.value === parseInt(value);
                    const chromaMatch = !chroma || chroma === 0 || color.chroma === parseInt(chroma);
                    return valueMatch && chromaMatch;
                });

                if (filteredColors.length > 0) {
                    filteredColors.forEach(color => {
                        const colorBox = document.createElement("div");
                        colorBox.className = "color-box";
                        colorBox.style.backgroundColor = color.hex;
                        colorBox.setAttribute('data-color', JSON.stringify(color));
                        colorBox.setAttribute('data-hue', hueData.hue);
                        colorBox.setAttribute('data-name', hueData.name);

                        colorBox.addEventListener("mouseenter", (event) => {
                            const rect = colorBox.getBoundingClientRect();
                            tooltip.innerHTML = `
                                <strong>${hueData.hue} - ${hueData.name}</strong><br>
                                Value: ${color.value} | Chroma: ${color.chroma}<br>
                                Hex: ${color.hex}
                            `;
                            tooltip.style.display = "block";
                            tooltip.style.top = `${rect.top - 80}px`;
                            tooltip.style.left = `${rect.left + rect.width/2 - tooltip.offsetWidth/2}px`;
                        });

                        colorBox.addEventListener("mouseleave", () => {
                            tooltip.style.display = "none";
                        });

                        colorBox.addEventListener("click", (e) => {
                            if (e.ctrlKey || e.metaKey) {
                                // Add to selection for export
                                if (selectedColors.has(color)) {
                                    selectedColors.delete(color);
                                    colorBox.style.border = "3px solid rgba(255, 255, 255, 0.8)";
                                } else {
                                    selectedColors.add(color);
                                    colorBox.style.border = "3px solid #ff6b6b";
                                }
                            } else if (e.shiftKey) {
                                // Add to favorites
                                const colorData = { ...color, hue: hueData.hue, name: hueData.name };
                                if (!favoriteColors.some(fav => fav.hex === color.hex)) {
                                    favoriteColors.push(colorData);
                                    localStorage.setItem('munsell-favorites', JSON.stringify(favoriteColors));
                                    updateFavoriteColors();
                                    
                                    // Visual feedback
                                    colorBox.style.transform = 'scale(1.2)';
                                    setTimeout(() => colorBox.style.transform = '', 300);
                                }
                            } else {
                                // Copy to clipboard
                                navigator.clipboard.writeText(color.hex).then(() => {
                                    const originalText = tooltip.innerHTML;
                                    tooltip.innerHTML = `${originalText}<br><em>Copied to clipboard!</em>`;
                                    setTimeout(() => {
                                        if (tooltip.style.display === "block") {
                                            tooltip.innerHTML = originalText;
                                        }
                                    }, 1500);
                                });
                            }
                        });

                        colorsGrid.appendChild(colorBox);
                        colorCount++;
                    });

                    hueCard.appendChild(colorsGrid);
                    chart.appendChild(hueCard);
                }
            });

            stats.textContent = `Showing ${colorCount} colors from ${filteredData.length} hues`;
        }

        function applyFilters() {
            const filters = {
                hue: filterHue.value,
                value: parseInt(filterValue.value),
                chroma: parseInt(filterChroma.value),
                search: searchBox.value.trim()
            };
            renderChart(filters);
        }

        // Event listeners
        filterHue.addEventListener("change", applyFilters);
        filterValue.addEventListener("input", () => {
            updateLabels();
            applyFilters();
        });
        filterChroma.addEventListener("input", () => {
            updateLabels();
            applyFilters();
        });
        searchBox.addEventListener("input", applyFilters);

        // Initialize
        updateLabels();
        updateFavoriteColors();
        renderChart();

        // Close modals when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }
            if (e.ctrlKey && e.key === 'e') {
                e.preventDefault();
                document.getElementById('export-modal').style.display = 'flex';
            }
            if (e.ctrlKey && e.key === 'f') {
                e.preventDefault();
                searchBox.focus();
            }
        });

        // Initialize comparison
        updateComparison();

        // Auto-save selected colors
        window.addEventListener('beforeunload', () => {
            if (selectedColors.size > 0) {
                localStorage.setItem('munsell-selection', JSON.stringify(Array.from(selectedColors)));
            }
        });

        // Load saved selection
        const savedSelection = localStorage.getItem('munsell-selection');
        if (savedSelection) {
            selectedColors = new Set(JSON.parse(savedSelection));
        }
    </script>
</body>
</html>
